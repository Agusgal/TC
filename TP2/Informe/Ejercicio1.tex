\input{Header.tex}

\newcommand\underrel[2]{\mathrel{\mathop{#2}\limits_{#1}}}

\usepackage{circuitikz}
\usepackage{xcolor}
\usepackage{amsmath}

\begin{document}


\section{Comportamiento de Amplificadores Operacionales.}

\subsection{Introducción}
En el presente punto se analizarán las limitaciones del amplificador operacional  \textbf{LM324} en las configuraciones inversora y no inversora.

Un amplificador operacional es un dispositivo electrónico el cual, dependiendo de la tensión de entrada, fija una tensión de salida. Estos se pueden modelar de la siguiente forma:
\begin{figure}[H]	
	\centering
	\includegraphics[width=0.7\textwidth]{Ejercicio1/Imagenes/Basicopamp.png}
	\caption{Modelo básico del amplificador operacional.}
	\label{fig:Basicopamp}
\end{figure}
donde típicamente $R_{in}\approx \infty$ y $R_{out} \approx 0$

\subsubsection{Modelo Ideal}
En el modelo ideal realimentado las hipótesis con las que se trabaja es que:
\begin{align} V^+ = V^- \end{align}
\begin{align}V_{Out} \underrel{A_{Vol}\to \infty}{=} A_{Vol} \cdot (V^+ - V^-) \end{align}
\begin{align} R_{in}=\infty   \thinspace;\thinspace R_{Out} = 0 \end{align}
%\begin{align}  \end{align}

\subsubsection{Modelo $A_{Vol}$ finito}
Para este modelo se le agregan idealidades al modelo anterior.
\begin{align}V_{Out} = A_{Vol} \cdot (V^+ - V^-)
\label{eq:vout}
\end{align}
Si bien la realimentación negativa intentará hacer que la diferencia entre $V^+$ y $V^-$ sea 0, no es algo que se asume en este modelo.

\subsubsection{Modelo Polo dominante}
Este modelo es el más cercano al real que se trata en el presente trabajo. Los amplificadores operacionales poseen un polo dominante, el cual está diseñado intencionalmente por el fabricante, para cubrir algunos problemas que surgen al trabajar con mayores frecuencias. Los amplificadores operacionales tienen una serie de polos debido, a capacidades parásitas propias de la construcción. El polo dominante es introducido para evitar que estos polos des-estabilicen el circuito al introducir una inversión en el lazo de realimentación.

\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/dompole.png}
	\caption{Modelo polo dominante.}
	\label{fig:dompole}
\end{figure}

El polo dominante soluciona estos problemas de estabilidad. También se define un ``Ancho de Banda'', con el cual se puede trabajar; comúnmente el dato con el que se trabaja es el conocido como GBP (Gain Bandwidth Product), el cual sigue la siguiente relación:

\begin{align} GBP= A_{Vol} \cdot \omega' \end{align}

donde $\omega'$ es la frecuencia del polo dominante a lazo abierto. También se cumple que 

\begin{align} GBP=\omega \cdot G \end{align}

donde $\omega$ es la frecuencia de corte del circuito en el que esté aplicado y G la ganancia del mismo.
Finalmente la ecuación principal que rige este modelo es (\ref{eq:vout}) con la singularidad de que:
\begin{align} A_{Vol} = A_{Vol}(\omega ) = \frac{A_{vol}}{1+\frac{s}{\omega '}} \end{align}

\subsection{Configuración inversora y no inversora.}
La cátedra propone dos modelos de circuitos diferentes, ambos son los siguientes:

\begin{figure}[H]
\begin{center}
\begin{circuitikz}
	\node [op amp](A1){};
	\draw (A1.-) to[short] ++(-3,0) to[R, l = $R_1$] ++(-2,0) to[short, -o] node[ocirc,label=left:$V_{in}$]{} ++(-1,0);
	\draw (A1.-) to[open] ++(-2,0) to[R, l_= $R_3$] ++(0,-2) node[ground]{};
	\draw (A1.-) node[label=south:$V^-$]{};
	\draw (A1.+) node[label=south:$V^+$]{};
	\draw (A1.+) to[short] ++(-1,0) to[short] ++(0,-1) node[ground]{};
	\draw (A1.-) to[short] ++(0,1.5) to[R, l = $R_2$] ++(3,0) to[short] ++(0,-2) to[R, l = $R_4$] ++(0,-1.5) node[ground]{};
	\draw (A1.out) to[short, -o] ++(2,0) node[ocirc,label=right:$V_{out}$]{};
	\end{circuitikz}
	\caption{Configuración inversora.}
	\label{fig:ConfInv}
\end{center}
\end{figure}

\begin{figure}[H]
\begin{center}
\begin{circuitikz}
	\node [op amp](A1){};
	\draw (A1.-) to[short] ++(-1.5,0) to[R, l_=$R_1$] ++(-1.5,0) to[short] ++(-1,0) node[ground]{};
	\draw (A1.-) node[label=south:$V^-$]{};
	\draw (A1.+) node[label=south:$V^+$]{};
	\draw (A1.-) to[short] ++(0,1.5) to[R, l = $R_2$] ++(3,0) to[short] ++(0,-2);
	\draw (A1.+) to[short] ++(-1,0) to[R, l = $R_4$] ++(0,-3) node[ground]{};
	\draw (A1.out) to[short, -o] ++(2,0) node[ocirc,label=right:$V_{out}$]{};
	\draw (A1.+) to[short] ++(-1,0) to[R, l= $R_3$] ++(-2,0) to[short, -o] node[ocirc,label=left:$V_{in}$]{} ++(-1,0);
	\end{circuitikz}
	\caption{Configuración no inversora.}
	\label{fig:ConfNoInv}
\end{center}
\end{figure}

Para ambos, y debido a que se utiliza el mismo operacional en cada caso, se obtuvieron los siguientes datos de la hoja de datos del fabricante:
\begin{table}[H]
\begin{center}
\label{tab:datos}
\begin{tabular}{|c|c|c|c|c|}
\hline
\multicolumn{5}{|c|}{\textbf{Datos pertinentes al operacional}}                                      \\ \hline
\textbf{$A_{vol}$} & $Max \ V_{in}$ & $V_{cm}$ & Slew rate             & GBW \\ \hline
100 k              & $32 \ V$         & $VCC \ - \ 1.5 \ V$  & 0.3 $\frac{V}{\mu s}$ & $1 \ MHz$  \\ \hline
\end{tabular}
\end{center}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Calculo Analítico del Circuito Inversor.}
Lo primero que se realizó fue utilizar el equivalente de Thevenin para simplificar los cálculos analíticos.

\begin{figure}[H]
\begin{center}
\begin{circuitikz}
	\node [op amp](A1){};
	\draw (A1.-) to[short] ++(-1,0) to[R, l = $R_{Thevenin}$] ++(-2,0) to[short, -o] node[ocirc,label=left:$V_{Thevenin}$]{} ++(-0.5,0);
	\draw (A1.-) node[label=south:$V^-$]{};
	\draw (A1.+) node[label=south:$V^+$]{};
	\draw (A1.+) to[short] ++(-1,0) to[short] ++(0,-1) node[ground]{};
	\draw (A1.-) to[short] ++(0,1.5) to[R, l = $R_2$] ++(3,0) to[short] ++(0,-2) to[R, l = $R_4$] ++(0,-1.5) node[ground]{};
	\draw (A1.out) to[short, -o] ++(2,0) node[ocirc,label=right:$V_{out}$]{};
	\end{circuitikz}
	\caption{Equivalente de Thevenin del circuito inversor.}
	\label{fig:Thevenin}
\end{center}
\end{figure}

Teniendo en cuenta que 
\begin{align}
	V_{Thevenin} = V_{in} \cdot \frac{R_3}{R_1+R_3} \\
	R_{Thevenin} = \frac{R_1\cdot R_3}{R_1+R_3}
\label{eq:thev}
\end{align} 

El cálculo es realizado para el caso genérico y una vez terminado el desarrollo se toman las aproximaciones necesarias para los diversos casos pedidos.
\begin{align}
V_{Out}= A_{Vol}(\omega) \cdot (V^+ - V^-)
\label{equ:avoligualvo}
\end{align}
\begin{align}
V^+=0\end{align}
\begin{align}\frac{V_{Th}-V^-}{R_{Th}}=\frac{V^--V_{Out}}{R_2}
\label{eq:nodeInv}
\end{align}

Despejando para $V_{Out}$ se llega a que:
\begin{align}
\label{eq:Vout}
V_{Out}=-V_{in} \cdot \frac{R_3}{R_1+R_3} \cdot \frac{\frac{R_2}{R_{Th}+R_2}\cdot A(\omega)}{1+\frac{R_{Th}}{R_{Th}+R_2}\cdot A(\omega)}
\end{align}

Teniendo en cuenta que la transferencia es $ H(s)=\frac{V_{Out}}{V_{in}}$.\\
Para el caso de $A_{Vol}=\infty$ simplemente basta tomar:
\begin{align}\lim_{A_{Vol}\to\infty} - \frac{R_3}{R_1+R_3} \cdot \frac{\frac{R_2}{R_{Th}+R_2}\cdot A(\omega)}{1+\frac{R_{Th}}{R_{Th}+R_2}\cdot A(\omega)} = -\frac{R_3}{R_1+R_3}\cdot\frac{R_2}{R_{Th}}=-\frac{R_2}{R_1}\end{align}

Para el caso de $A_{Vol}$ finito solamente se reescribirá (\ref{eq:Vout}).

\begin{align}
H(s)= -\frac{R_2\cdot A_{Vol}}{R_1\cdot R_3+R_1\cdot R_3 \cdot A_{Vol} +R_2\cdot R_3+R_2\cdot R_1}
\label{eq:AvolFinite}
\end{align}

Finalmente el caso el cual incluye el polo dominante alcanza con tomar: 

\begin{align}A_{Vol}(\omega)=A_0 \cdot \frac{1}{1+\frac{s}{\omega'}}
\label{eq:PoloDom}
\end{align}

donde $\omega'$ es la frecuencia del polo dominante. Utilizando (\ref{eq:AvolFinite}) y (\ref{eq:PoloDom}) se llega a la expresión:
\begin{align}
\label{eq:polodom}
H(s)=-\frac{A_0R_2R_3}{A_0R_1R_3+R_1R_2+R_1R_3+R_2R_3} \cdot\frac{1}{1+\frac{s}{\omega' \cdot \frac{A_0R_1R_3+R_1R_2+R_1R_3+R_2R_3}{R_1R_2+R_1R_3+R_2R_3}}}
\end{align}

De (\ref{eq:polodom}) se obtiene la frecuencia de corte del sistema.
\begin{align}
f_c=\frac{\omega'}{2\pi} \cdot \frac{A_0R_1R_3+R_1R_2+R_1R_3+R_2R_3}{R_1R_2+R_1R_3+R_2R_3}
\end{align}
Luego, teniendo en cuenta que
\begin{align}
\omega'=\frac{GBW}{A_0} = 2 \pi\cdot 10 \ Hz \approx 62.83 \ Hz
\end{align}

Para este grupo, los valores de resistencias asignados se presentan a continuación:
\begin{table}[H]
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline
\textbf{Caso:}              & \textbf{1}               & \textbf{2}               & \textbf{3}                \\ \hline
$R_1=R_3$                   & $7.5$                      & $7.5$                      & $75$                       \\ \hline
$R_2$                       & $75$                       & $7.5$                      & $7.5$                       \\ \hline
\multicolumn{1}{|c|}{$R_4$} & \multicolumn{1}{l|}{$30$} & \multicolumn{1}{l|}{$30$} & \multicolumn{1}{l|}{$300$} \\ \hline
\end{tabular}
\caption{Valores de resistencias en $k\Omega$}
\label{tabla:resasignadas}
\end{center}
\end{table}

Para estos casos se calculó la ganancia considerando $A_{Vol}$ finito e infinito. Además, se calculó la frecuencia de corte del sistema para $A(\omega)$.

\begin{table}[H]
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline
\textbf{Caso}            & \textbf{1} & \textbf{2} & \textbf{3} \\ \hline
\textbf{$H(s)_{\infty}$} & 10         & 1          & 0.1        \\ \hline
\textbf{$H(s)_{Finito}$} & 9.9998     & 0.9999     & 0.0999     \\ \hline
\textbf{$f_c$}           & 47.62 kHz   & 333.34 kHz  & 833.34 kH     \\ \hline
\end{tabular}
\end{center}
\end{table}

Luego se procedió a realizar los graficos de $A_{Vol}(\omega)$ para cada uno de los 3 casos.
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/HCompC1.png}
	\caption{$A_{Vol}(\omega)$ Caso 1.}
	\label{fig:AvolC1}
\end{figure}
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/HCompC2.png}
	\caption{$A_{Vol}(\omega)$ Caso 2.}
	\label{fig:AvolC2}
\end{figure}
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/HCompC3.png}
	\caption{$A_{Vol}(\omega)$ Caso 3.}
	\label{fig:AvolC3}
\end{figure}

Se puede apreciar que cuanto más baja la gananci, mayor será el ancho de banda, y que a partir de la frecuencia de corte cada sistema el opamp comienza a atenuar.


El error de utilizar el caso de $A_{Vol}$ ideal en lugar del caso con polo dominante se calculó como:
\begin{align}
	Error = \frac{|A_{Vol}(\omega)-A_{Vol-Ideal}|}{A_{Vol}(\omega)}
\end{align}

obteniendo los siguientes gráficos:

\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/error1.png}
	\caption{Error relativo por aproximar Caso 1.}
	\label{fig:e1}
\end{figure}
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/error2.png}
	\caption{Error relativo por aproximar Caso 2.}
	\label{fig:e2}
\end{figure}
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/error3.png}
	\caption{Error relativo por aproximar Caso 3.}
	\label{fig:e3}
\end{figure}

De estos, es posible concluir que se puede utilizar la aproximación ideal siempre y cuando se tengan en cuenta el error que uno comete y sea aceptable.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Calculo Analítico del Circuito No Inversor.}

De la misma forma que en el circuito inversor, se decidió aplicar el teorema de Thevenin.

\begin{figure}[H]
\begin{center}
\begin{circuitikz}
	\node [op amp](A1){};
	\draw (A1.-) to[short] ++(-1,0) to[R, l_=$R_1$] ++(-1.5,0) to[short] ++(-0.5,0) node[ground]{};
	\draw (A1.-) node[label=south:$V^-$]{};
	\draw (A1.+) node[label=south:$V^+$]{};
	\draw (A1.-) to[short] ++(0,1.5) to[R, l = $R_2$, i<_= $I_f$] ++(3,0) to[short] ++(0,-2);
	\draw (A1.out) to[short, -o] ++(1,0) node[ocirc,label=right:$V_{out}$]{};
	\draw (A1.+) to[short] ++(-1,0) to[R, l= $R_{Thevenin}$] ++(-1.5,0) to[short, -o] node[ocirc,label=left:$V_{Thevenin}$]{} ++(-0.5,0);
	\end{circuitikz}
	\caption{Equivalente de Thevenin del circuito inversor.}
	\label{fig:noinvThevenin}
\end{center}
\end{figure}

Siendo 
\begin{align}
	V_{Thevenin} = V_{in} \cdot \frac{R_4}{R_4+R_3} \\
	R_{Thevenin} = \frac{R_4\cdot R_3}{R_4+R_3}
\label{eq:noinvthev}
\end{align} 

Utilizando (\ref{equ:avoligualvo}) y planteando además

\begin{equation}
	V^+ = V_{Thevenin}
	\label{equ:noinvv+}
\end{equation}

\begin{equation}
	V^- = I_f R_1
\end{equation}

\begin{equation}
	V_{out} - I_f R_1 = V^-
\end{equation}

y operando algebraicamente, se puede demostrar que

\begin{equation}
	H \left(s \right) =\frac{A_{0}}{R_3} \cdot	\frac{R_3 // R_4}{1 \ + \ A_{0} \frac{R_1 // R_2}{R_2} } \cdot \left[ \frac{s}{\omega' \cdot \left( 1 + A_{0} \frac{R_1 // R_2}{R_2} \right)}  \ + \ 1 \right]^{-1}
	\label{equ:noinvtransferencia}
\end{equation}

considerando para este caso (\ref{eq:PoloDom}).

Para el caso de $A_{Vol}=\infty$ simplemente basta tomar:
\begin{align}
	\lim_{A_{Vol}\to\infty} H \left(s \right) = \frac{R_3 // R_4}{R_3} \cdot \frac{R_2}{R_1 // R_2}
\end{align}

Por otro lado, para $A_{Vol}$ finito solamente ...

\begin{center}
\textcolor{red}{\textbf{COMPLETAR}}
\end{center}

De (\ref{equ:noinvtransferencia}) se tiene que

\begin{equation}
	f_c = \frac{\omega'}{2 \pi}\cdot \left( 1 + A_{0} \frac{R_1 // R_2}{R_2} \right)
\end{equation}

Reemplazando con los valores presentados en la Tabla (\ref{tab:datos}), se llega a ...

\begin{center}
\textcolor{red}{\textbf{COMPLETAR}}
\end{center}

Nuevamente se calculó la ganancia considerando $A_{Vol}$ finito e infinito. Además, se calculó la frecuencia de corte del sistema para $A(\omega)$.

\begin{table}[H]
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline
\textbf{Caso}            & \textbf{1} & \textbf{2} & \textbf{3} \\ \hline
\textbf{$H(s)_{\infty}$} & x         & x          & x        \\ \hline
\textbf{$H(s)_{Finito}$} & x     & x     & x     \\ \hline
\textbf{$f_c$}           & x kHz   & x kHz  & x kH     \\ \hline
\end{tabular}
\end{center}
\end{table}

\begin{center}
\textcolor{red}{\textbf{COMPLETAR}}\\
\textcolor{red}{\textbf{PONER LOS GRÁFICOS}}\\
\textcolor{red}{\textbf{INCLUYENDO EL ERROR}}
\end{center}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Impedancia de entrada.}

Para calcular la impedancia de entrada de los casos presentados se sigue la misma idea de la primer parte.

Se procede a analizar el caso del inversor.

\begin{align}
\label{eq:Zin}
\frac{V_{Th} - V^-}{R_{Th}}=I_{in}
\end{align}
Utilizando (\ref{eq:thev}), (\ref{eq:nodeInv}), (\ref{eq:Vout}) y (\ref{eq:Zin}), se puede llegar a la siguiente expresión:
\begin{align}
	Z_{in}(s)=\frac{A_{Vol}R_1R_3+R_1R_2+R_2R_3+R_1R_3}{A_{Vol}R_3+R_2+R_3}\cdot \frac{1+\frac{s\cdot (R_1R_2+R_1R_3+R_2R_3)}{\omega ' \cdot (A_{Vol}R_1R_3+R_1R_2+R_1R_3+R_2R_3)}}{1+\frac{s\cdot (R_2+R_3)}{\omega ' \cdot(A_{Vol}R_3+R_2+R_3)}}
\end{align}
Tambien se puede observar en (\ref{eq:Zin}) que si $A_{Vol}$ es infinito, se cumple
\begin{align} V^- = V^+=0 \implies Z_{in}=R_1
\end{align}

Por otro lado, planteando de forma similar para el no inversor:

\begin{align}
\label{eq:noinvZin}
\frac{V_{Th} - V^+}{R_{Th}}=I_{in}
\end{align}

y valiendose del uso de (\ref{equ:noinvv+}), se llega a

\begin{equation}
	Z_{in} = R_3 + R_4
\end{equation}

Las mediciones de la impedancia de entrada se realizaron de la siguiente manera:

\begin{center}
\begin{circuitikz}[american voltages] \draw (0,0)
  node[draw,minimum width=2cm,minimum height=2.4cm] (load) {Load}
  ($(load.west)!0.75!(load.north west)$) coordinate (la)
  ($(load.west)!0.75!(load.south west)$) coordinate (lb)
  (lb) to[short,-o] ++(-0.5,0) coordinate (b) node[ground]{}
  to[short] ++(-4,0) coordinate (VThb)
  to[sV=$V_{\mathrm{In}}$] (VThb |- la)
  to[R=$R$] ++(2.5,0) coordinate (VTht)
  to[short,-o,i=$I_{In}$] (VTht -| b) coordinate (a) node[above] {$A$}
  to[short] (la);
  \path (a) node[below] {$+$} -- node {$V$} (b) node[above] {$\vphantom{+}-$};
\end{circuitikz}
\end{center}
Se midio la señal tanto de entrada y como en el punto A, luego se valió de la función de resta del modo ``math'' del osciloscopio. Luego, se midió la proporción en decibeles y la fase de esta última señal y de la entrada, obteniendo un conjunto de medidas, las cuales corresponden a la siguiente expresión:
\begin{align}
20\log\left(\frac{V_{(A-In)}}{V_{in}}\right)
\end{align}
A partir de estos valores se puede obtener la impedancia de entrada:

\begin{align}
Z_{In}=20\log\left(\frac{V_{In}}{I_{in}}\right) =20\log\left(\frac{V_{In} \cdot  R}{V_{(A-In)}}\right) = -20\log\left(\frac{V_{(A-In)}}{V_{In} }\right)+20\log (R)
\end{align}

Luego se realizaron mediciones de la impedancia de entrada y se compararon con simulaciones realizadas en LTSpice y con el calculo analítico.
Cabe aclarar que para los gráficos, al realizar el calculo analítico, no fueron tomadas en cuentas las puntas del osciloscopio, las cuales se emplearon en modo \textbf{x1}, de forma que alteraron la medición, mientras que en las simulaciones con LTSpice si fueron tomadas en cuenta.

Aquí se presentan las mediciones realizadas para el circuito inversor.

\begin{figure}[H]	
	\centering
	\includegraphics[width=0.9\textwidth]{Ejercicio1/Imagenes/ZinC1.png}
	\caption{Impedancia de entrada Caso 1.}
	\label{fig:CompZinC1}
\end{figure} 

\begin{figure}[H]	
	\centering
	\includegraphics[width=0.9\textwidth]{Ejercicio1/Imagenes/CZinC2.png}
	\caption{Impedancia de entrada Caso 2.}
	\label{fig:CompZinC2}
\end{figure} 
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/CZinC3.png}
	\caption{Impedancia de entrada Caso 3.}
	\label{fig:CompZinC3}
\end{figure} 

\begin{figure}[H]	
	\centering
	\includegraphics[width=0.9\textwidth]{Ejercicio1/Imagenes/ZinphC1.png}
	\caption{Impedancia de entrada Caso 1.}
	\label{fig:CompZinphC1}
\end{figure} 

\begin{figure}[H]	
	\centering
	\includegraphics[width=0.9\textwidth]{Ejercicio1/Imagenes/ZinphC2.png}
	\caption{Impedancia de entrada Caso 2.}
	\label{fig:CompZinphC2}
\end{figure} 
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/ZinphC3.png}
	\caption{Impedancia de entrada Caso 3.}
	\label{fig:CompZinphC3}
\end{figure}

También cabe destacar que en las Figuras (\ref{fig:CompZinphC2}) y (\ref{fig:CompZinphC3}) realmente no hay un salto, sino que es un cambio de fase de $360^{\circ}$.

Luego se procede a mostrar las mediciones realizadas para el caso del circuito no inversor.

\begin{center}
\textcolor{red}{\textbf{COMPLETAR}}
\end{center}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Máximos valores de entrada.}
El máximo valor de entrada a partir del cual el Opamp satura estará definido por diversas variables, siendo algunas de ellas la amplitud de entrada de la señal, la ganancia del sistema y la frecuencia de entrada.

Para buscar estos valores nos centraremos en los 3 casos a analizar. 
Asumiendo el opamp con ganancia ideal y sabiendo que:
\begin{align} V_{Out}=H(s)\cdot V_{in}\end{align}
El máximo valor de $V_{in}$ quedará definido por la tensión de saturación del opamp. Que para el \textbf{LM324} es VCC-1.5 lo cual para nuestro caso será 13.5V\footnote{Esta información fue extraida de la hoja de datos}
Luego utilizando esta relación se realizó el siguiente cuadro para las distintas ganancias que utilizaremos\footnote{Para el caso 3 si bien matemáticamente la máxima $V_{in}$ es 135V en la hoja de datos nos informa que el máximo que soporta el dispositivo sin quemarse es de 32V }.
\begin{table}[H]
\begin{center}
\label{tab:maxin}
\begin{tabular}{|c|c|c|c|}
\hline
\textbf{Caso:}        & \textbf{1} & \textbf{2} & \textbf{3} \\ \hline
\textbf{Ganancia ideal}     & 10         & 1          & 0.1        \\ \hline
\textbf{$V_{in-Max}$} & 1.35       & 13.5       & 32         \\ \hline
\end{tabular}
\end{center}
\end{table}
Luego se graficó la maxima tension de entrada en funcion de la ganancia:
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/maxvin.png}
	\caption{Maxima tensión de entrada en funcion de la Ganancia.}
	\label{fig:MaxVin}
\end{figure} 
Tambien se analizó la máxima amplitud de entrada en funcion de la frecuencia tal que no haya slew-rate \footnote{el cual es un efecto que se detallará luego en su propia sección} ni saturación.
La cual puede ser apreciada en el siguiente gráfico:
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/maxvinsr.png}
	\caption{Maxima tensión de entrada sin saturación ni slew-rate.}
	\label{fig:MaxVinsr}
\end{figure} 
%%%%%%%%%%%%%%%%%%
\subsubsection{Principales Caracteristicas.}
En el caso que $R_3$ sea igual a 0 a la salida del opamp deberia haber 0V, esto no es la realidad dado a que existe una tensión de offset la cual será analizada en la seccion 3 de este informe.
El proposito de $R_4$ a primera vista no es evidente dado que la transferencia es independiente de ella, pero observando que existe una corriente máxima\footnote{Obteniendo el valor de la datasheet se sabe que $I_{Max}=20mA$} que puede aportar el opamp se llego a  que el proposito de $R_4$ es limitar la corriente por lo tanto su valor debe ser $R_4>\frac{V_{Out}}{I_{Max}}$ .
Otra funcion para la $R_4$ es el limitar la corriente del lazo.
%%%%%%%%%%%%%%%%%%%%
\subsubsection{DC-Sweep.}
Se realizó un barrido entre -VCC y VCC utilizando un generador de funciones con una rampa y un circuito inversor para llegar a la tension de salida necesitada dado a que el generador de funciones solo puede entregar 20Vpp.
El comportamiento del opamp no es lineal para todo el rango de entradas, su comportamiento lineal se puede observar unicamente en el rango entre -Vsat y Vsat, tenienod tensiones de entrada máxima para cada caso las que se observan en la figura (\ref{fig:MaxVinsr})
Se registraron las siguientes mediciones:
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/dc_sweep_c1.png}
	\caption{DC-sweep Caso 1.}
	\label{fig:dcc1}
\end{figure} 
Se puede observar en este caso como el opamp satura a partir de una rension mayor a 1.35 Volts como se predijo en le punto (a)
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/dc_sweep_c2.png}
	\caption{DC-sweep Caso 2.}
	\label{fig:dcc2}
\end{figure} 
En esta figura se ve como el comportamiento del opamp es lineal en la mayoria del espectro expeto en las puntas donde alli lo deja de ser como fue predicho en el punto (a) a unos $\approx$ 13.5 V
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/dc_sweep_c3.png}
	\caption{DC-sweep Caso 3.}
	\label{fig:dcc3}
\end{figure} 
Finalmente en esta figura se ve que el opamp tiene comportamiento lineal para todos los valores de la rampa
Otro efecto alineal del amplificador operacional que fue observado es el efecto de Cross-over el cual es introducido dado a la polarización de los transistores que tiene por dentro el operacional; uno puede evitar tener que lidear con ese problema al agregar una tensión de offset de continua que baste para polarizar los transistores, en este trabajo los valores utilizados fueron 0.7V ó 1.4V; otra manera es tener una señal con valor medio mayor a $\approx$ 0.7v. Este efecto se hace notar como una desformación a llanura en la transición por 0 V como  se puede apreciar en la figura (\ref{fig:co})
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/CrossOver.png}
	\caption{Señal con Cross-Over.}
	\label{fig:co}
\end{figure} 

%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Slew-Rate.}
El slew-rate esta definido como la máxima variación temporal de la salida del opamp. El slew-Rate depende de 3 parametros siendo estos la frecuencia, la amplitud y la ganancia; esto siendo para una senoidal, pero dado que se puede desdcribir cualquier señal como una combinación lineal de senos se puede decir que el slewrate de una señal arbitraria tambien dependerá de estos parametros.
Si se le demanda a l opamp una tasa de cambio mayor a la soportada por le SR procedera a distorcionar la señal.
\begin{align}  SR= Max\left( \frac{\partial V_{Out}}{\partial t}\right)  \end{align}
Utilizando una entrada senoidal de la forma.
$$V_{in}=A\cdot \sin (\omega t)$$
\begin{align}   SR= Max\left( \frac{\partial (G\cdot A\cdot \sin (\omega t))}{\partial t}\right) = A \cdot \omega \cdot G  
\label{eq:sr}
\end{align}
A partir de la expresión  (\ref{eq:sr}) se llega a una relacion que debe cumplir la señal de entrada para no presentar efectos de slew-rate. Esta limitacion tiene un grado de libertad, por lo tanto se puede elegir un parametro fijo y regular el otro, por ejemplo fijando la frecuencia de entrada se debera cumplir que:
\begin{align} V_{in}	\leq \frac{SR}{G\cdot \omega_0}\end{align}
Se midió el Slew-Rate  utilizando como entrada una senoidal obteniendo la siguiente medición:
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/slew_rate1.png}
	\caption{Medición Slew-Rate.}
	\label{fig:SlewRate}
\end{figure}
De aqui utilizando la ecuación (\ref{eq:sr}) se obtiene que:
\begin{align}
SR \approx  0.38 \frac{V}{\mu s}
\end{align}
lo cual concuerda con lo provisto por el fabricante de la tabla (\ref{tab:datos})
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Respuesta en frecuencia.}
Se midió la respuesta en frecuencia de la configuración en los diversos casos y se grafico junto a simulaciones hechas en spice y el calculo teórico.
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/BodeC1.png}
	\caption{Diagrama de Bode Amplitud Caso 1.}
	\label{fig:BodeC1}
\end{figure} 
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/BodephC1.png}
	\caption{Diagrama de Bode fase Caso 1.}
	\label{fig:BodephC1}
\end{figure} 
En estas mediciones el principal problema que se presento fue el hecho de que habia que lidear con que el opamp saturaba, se hacian evidentes los efectos del slew-rate  dado a que esta configuracion amplifica y efecto de  Cross-over. Tambien un problema fue que dada que la tensiond e entrada era tan pequeña como se puede apreciar en la figura (\ref{fig:MaxVinsr}), la señal se encontraba con ruido el cual era amplificado y se obtenia mayor ruido a la salida.
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/BodeC2.png}
	\caption{Diagrama de Bode Amplitud Caso 2.}
	\label{fig:BodeC2}
\end{figure} 
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/BodephC2.png}
	\caption{Diagrama de Bode fase Caso 2.}
	\label{fig:BodephC2}
\end{figure} 
Aqui deberia decir algo util
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/BodeC3.png}
	\caption{Diagrama de Bode Amplitud Caso 3.}
	\label{fig:BodeC3}
\end{figure} 
\begin{figure}[H]	
	\centering
	\includegraphics[width=\textwidth]{Ejercicio1/Imagenes/BodephC3.png}
	\caption{Diagrama de Bode fase Caso 3.}
	\label{fig:BodephC3}
\end{figure} 
Para las mediciones del tercer caso se presento el problema de que al estar atenuando y la señal a medir se encontraba cerca del pisod e ruido a altas frecuencias y era complicado realizar las mediciones. Algo que se puede apreciar en esta medicion es la aparición de un sobrepico ne las mediciones. Estas mediciones fueron hechas con una punta \textbf{x10} la cual introdujo un polo mas y se armó un sistema de segundo orden el cual agrega el sobrepico.
\subsubsection{Limitaciones.}
Algunas limitaciones con las cuales se lidaron al utilizar este operacional fueron la intervención del slew-rate, el efecto de cross-over, la saturación del mismo.
En el caso de que se quiera trabajar con una señal cuadrada  de 1 Vpp en un rango de frecuencias de 0.3MHz~2MHz con un Duty Cycle entre 20\% y 80\%  no funcionará dado a que se presentaran problemas de slew-Rate. Se presentarán problemas de Cross-Over cuando la media de la señal no supere los 0.7V.
Viendo que el opamp LM324 no funcionaría para esta aplicación se encontraron X amplificadores operacionaes que pueden ser utilizados con una señal de las caracteristicas recien mencionadas, agregandole que tenga un valor medio 0 y un DT de 50\% loa cules son: TL084,
\subsection{Configuración No-inversora.}
\end{document}